<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
    <title>Three.JS Prototype</title>
</head>
<body>
    <script src="/week3/practise/three.js">
        // main THREE.js library
    </script>
    <script src="/week3/prototype/GLTFLoader.js">
        // maakt het inlezen van 3d model mogelijk
    </script> 
    <script src="/week3/prototype/OrbitControls.js">
        // maakt het ronddraaien van de animatie mogelijk
    </script>

    <div style="text-align: center; z-index: 265;">
        <button id="btnHorse" style="margin: 20px; z-index: 265;" type="button" class="btn btn-dark">Horse</button>
        <button id="btnChicken" style="margin: 20px; z-index: 265;" type="button" class="btn btn-dark">Chicken</button>

    </div>


    <script>

        var mixer, camera, scene, renderer, clock;  // variabelen

        var currentChicken = "/week3/prototype/chicken.gltf";
        var currentHorse = "/week3/prototype/horsenew.gltf";


        // init();                     // functie van het inladen en vaststellen van parameters
                        // functie die de animatie loopt op basis van de tijd

        // function init() {     

            /// CAMERA instellen
            // pov van 45, grootte op basis van gebruikersscherm, near en far van 1-1000
            camera = new THREE.PerspectiveCamera(35, window.innerWidth/window.innerHeight, 1, 500);
            camera.position.set(20, 5, 25);
            
            /// SCENE
            scene = new THREE.Scene();
            // background color van scene (lightblauw)
            scene.background = new THREE.Color(0xADF0ED);

            /// create animation inside containerdiv
            var container = document.createElement('div');
            document.body.appendChild(container);
        
            /// clock voor timen van animatie
            clock = new THREE.Clock();
                
            /// LIGHTS
            // basic light die direct van bovenaf komt
            var light = new THREE.HemisphereLight(0xffffff, 0x444444, 0.8);
            light.position.set(0, 250, 0);
            scene.add(light);
            // light die van een richting afkomt, kan ook schaduwen creeÃ«ren
            light = new THREE.DirectionalLight(0xffffff, 0.8);
            light.position.set(20, 30, 15);
            scene.add(light);

            /// RENDERER        
            renderer = new THREE.WebGLRenderer();
            // past de qualiteit aan aan de gebruiker
            renderer.setPixelRatio(window.devicePixelRatio);
            // past de afmetingen aan aan die van de gebruiker
            renderer.setSize(window.innerWidth, window.innerHeight);
            // zet de renderer binnen de body
            container.appendChild(renderer.domElement);
        
            /// ORBITCONTROLS
            var controls = new THREE.OrbitControls(camera, renderer.domElement);
            // schakelt het 'rondwandelen' d.m.v. de rechtermuisknop uit
            controls.enablePan = false;
            // hoe dichtbij/verweg de camera mag komen
            controls.minDistance = 5;
            controls.maxDistance = 50;

            /// LOADER
            var loader = new THREE.GLTFLoader();

        // }

        animate();  

        function loadAnimation(filename, onLoaded){

            loader.load(filename, function(gltf){
                var foundAnimation = '';
                gltf.scene.traverse(function(node){
                    if(node.isAnimation){
                        foundAnimation = node;
                        foundAnimation.material.map.anisotropy = maxAnisotropy;
                    }
                });
                if(foundAnimation){
                    onLoaded(foundAnimation);
                }
            })
        }

        loadAnimation("/week3/prototype/horsenew.gltf", function(nextAnimation){

            document.getElementById("btnChicken").addEventListener("click", function(){

                // Als er al een animatie is, verwijderen
                if(currentHorse){
                    scene.remove(currentHorse);
                }
                scene.add(currentChicken);
                currentHorse = nextAnimation;
            })
        })

        loadAnimation("/week3/prototype/chicken.gltf", function(nextAnimation){

            document.getElementById("btnHorse").addEventListener("click", function(){
            
                // Als er al een animatie is, verwijderen
                if(currentChicken){
                    scene.remove(currentChicken);
                }
                scene.add(currentHorse);
                currentHorse = nextAnimation;
            })
        })



        // laad de gltf file in en voegt het toe aan de scene
        // geeft als parameter de locatie van de animatie mee + een functie die de animatie toevoegd aan de scene        
        // loader.load("/week3/prototype/chicken.gltf", function (gltf){
        //     
        //     scene.add(gltf.scene);
        //     /// MIXER
        //     mixer = new THREE.AnimationMixer(gltf.scene);
        //     // array van de animatieclips worden afgespeeld
        //     mixer.clipAction(gltf.animations[0]).play();
        // 
        // } );



        /// ANIMATE
        function animate() {

            requestAnimationFrame(animate);

            // speelt de animatie constant af op basis van een clock
            if (mixer) {

                mixer.update(clock.getDelta());

            }

            /// RENDER
            renderer.render(scene, camera);       
        }



        
    </script>
    
</body>
</html>